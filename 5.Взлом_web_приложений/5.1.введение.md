### Основные понятия

**Веб-приложения** — это особенный вид сетевых сервисов, доступных для атак хакера, т.к. эти сервисы при разработке по
умолчанию неуязвимы, в отличие от некоторых коробочных решений, которые после развертывания сразу обладают рядом проблем
безопасности, которые нужно превентивно устранить.

**Аутентификация** — это процесс проверки подлинности идентификационных данных пользователя, таких, как логин и пароль,
чтобы убедиться, что он является тем, за кого себя выдает; по сути, процесс проверки личности конкретного пользователя
или клиента для последующего доступа к ресурсу.

**Авторизация** — это процесс проверки прав пользователя на выполнение определенных действий или доступ к определенным
ресурсам системы. Пользователь может быть аутентифицирован, но не авторизован на выполнение определенной операции, если
у него нет необходимых прав.

**Идентификация** — это процесс определения личности пользователя на основе предоставленных им идентификационных данных,
таких как имя, адрес электронной почты или номер телефона. Идентификация часто используется вместе с аутентификацией для
подтверждения подлинности пользователя.

**Атака грубой силы** — это метод криптоанализа, при котором злоумышленник пытается взломать пароль или зашифрованные
данные
путем перебора возможных комбинаций до тех пор, пока не будет найдено правильное сочетание. Атака грубой силы может быть
эффективной, если пароль короткий или используется слабый алгоритм шифрования, однако, при достаточной длине и сложности
пароля, такая атака может занять слишком много времени или быть совсем неэффективной.

**Инъекция команд ОС (также известная как shell инъекция)** — уязвимость веб-приложений, которая позволяет
злоумышленнику
выполнять произвольные команды операционной системы (ОС) на сервере, на котором запущено приложение, и, как правило,
дает возможность полностью скомпрометировать приложение и все его данные.

Очень часто злоумышленник может использовать уязвимость внедрения команд ОС для компрометации других частей
инфраструктуры, используя доверительные отношения для перенаправления атаки на другие системы в организации.

**Контроль доступа** — это процесс управления доступом пользователей к ресурсам системы, включая определение прав
доступа и
ограничений на использование ресурсов. Контроль доступа обеспечивает безопасность системы, ограничивая доступ
пользователей только к необходимым ресурсам и операциям.

**Язык структурированных запросов (SQL)** – это язык программирования для хранения и обработки информации в реляционной
базе
данных. Реляционная база данных хранит информацию в табличной форме со строками и столбцами, представляющими различные
атрибуты данных и различные связи между значениями данных. Инструкции SQL можно использовать для хранения, обновления,
удаления, поиска и извлечения информации из базы данных. Можно также использовать SQL для поддержания и оптимизации
производительности базы данных.

**SQL-инъекция** — это уязвимость веб-приложений, позволяющая злоумышленнику вмешиваться в запросы, которые приложение
делает к своей базе данных. Она позволяет злоумышленнику просматривать данные, которые он, как правило, не может
получить.

**Обратный путь в каталогах (также известный как обход файловых путей)** — это уязвимость веб-безопасности, позволяющая
злоумышленнику читать произвольные файлы на сервере, на котором запущено приложение. Сюда могут входить код приложения и
данные, учетные данные для внутренних систем и конфиденциальные файлы операционной системы.

**Расширяемый язык разметки (XML)** позволяет определять и хранить данные совместно используемым способом. XML
поддерживает
обмен информацией между компьютерными системами, такими, как веб-сайты, базы данных и сторонние приложения.
Предопределенные правила упрощают передачу данных в виде XML-файлов по любой сети, поскольку получатель может
использовать эти правила для точного и эффективного чтения данных.

**Инъекция внешних сущностей XML (также известная как XXE)** — это уязвимость веб-безопасности, позволяющая
злоумышленнику
вмешиваться в обработку XML-данных приложения. Часто она позволяет злоумышленнику просматривать файлы на файловой
системе сервера приложений, а также взаимодействовать с любыми внутренними или внешними системами, к которым имеет
доступ само приложение.

В большом числе случаев злоумышленник может усилить атаку XXE для компрометации основного сервера или другой внутренней
инфраструктуры, используя уязвимость XXE для выполнения атак на подделку запроса на стороне сервера (SSRF).

**Межсайтовый скриптинг (также известный как XSS)** — это уязвимость веб-безопасности, позволяющая злоумышленнику
компрометировать взаимодействие пользователей с уязвимым приложением. Она позволяет злоумышленнику обходить политику
одного источника (Same Origin Policy (SOP)), которая предназначена для разделения различных веб сайтов друг от друга.

### Разбор базового примера

Рассмотрим пример компрометации механизма аутентификации веб-приложения на примере

1. Исследуем веб-приложение на предмет наличия в нем прочих файлов и разделов.

Рассмотрим использование утилиты ffuf, используемой для обнаружения существующих путей до файлов и директорий на
веб-сервере.

Для ведения перебора понадобится словарь путей, например:
https://github.com/empty-jack/YAWR/blob/master/Web/files_and_directories/fuzz.txt

Укажем утилите следующие ключи:

-w – путь до файла со словарем;
-u – целевой URL, в который необходимо поместить слово FUZZ для указания места для вставки паттернов из словаря,
-fc – фильтрация кодов HTTP-ответов.
ffuf -w ~/Repositories/YAWR/Web/files_and_directories/fuzz.txt -u http://evil.corp:1337/FUZZ -fc 403

Мы видим, что ffuf обнаружил следующие файлы:

С помощью браузера переходим в директорию /admin/ и обнаруживаем панель администратора:

2. Попробуем выявить уязвимости в механизме аутентификации.

Попробуем зайти в интерфейс панели, используя логин admin и любой пароль, это нужно для дальнейшего анализа запроса в
BurpSuite:

Для подбора учетных данных проанализируем запрос в BurpSuite:

Как видим, логин и пароль передаются в параметрах usename и password.

Ошибка, реализованная в данном механизме, заключается в том, что нет ограничения на количество попыток аутентификации.

3. Проведем атаку методом перебора.

Попробуем перебрать значение поля password используя модуль Intruder.

Intruder – модуль BurpSuite, позволяющий делать запросы, подставляя различные значения параметров по словарю и другими
способами, и анализировать ответы веб-приложения, например, для поиска сообщений об ошибках и других аномалий, перебора
учетных данных или поиска объектов с предсказуемыми идентификаторами.

В окне Intruder нужно выделить требующие перебора позиции в запросе, в данном случае достаточно выделить значения
параметров username и password.

Выберем тип атаки Cluster Bomb: эта атака повторяет различные сочетания полезных нагрузок из нескольких наборов для
каждой определенной позиции. Это значит, что, если мы зададим два набора полезных нагрузок: из логинов и из паролей, то
для каждого логина будут последовательно перебираться все пароли.

Перейдем на вкладку Payloads и добавим в первый Payload set имя пользователя – admin с помощью поля Add.

Для перебора паролей используем словарь по ссылке:

https://github.com/empty-jack/YAWR/blob/master/brute/passwords/realyBest.txt

Скопируем и вставим пароли из списка:

Запустим атаку. Видим, что если отсортировать длины запросов, то после 75 запроса с паролем admin статус 200 сменился на
303, перенаправляющий на otp.php; таким образом, первый фактор аутентификации был успешно найден.

Альтернативные способы
Burp Suite не единственный инструмент для атак перебора пароля, есть множество альтернатив, например:

Patator
Medusa
Hydra
Owasp Zap
Для примера вот как выполнить подбор для той же формы:

hydra -l admin -P ./realyBest.txt -s 1337 127.0.0.1 http-post-form -m "/admin/:username=^USER^&password=^PASS^:g=:2=:F=>
Login</button>"

### Общие принципы

Для компрометации веб-приложений используются уязвимости, которые возникают при написании веб-приложений. И только
благодаря им компрометация становится возможной.

Уязвимости в веб-приложениях возникают только тогда, когда разработчиком допущена какая-либо ошибка. Такие ошибки
складываются в целые группы типовых уязвимостей, т.е. ошибок, которые системно возникают в тех или иных механизмах,
реализуемых в веб-приложениях.

Примеры механизмов:

- Аутентификация
- Авторизация
- Менеджмент сессий
- Хранение файлов
- Работа с базами данных
- Генерация медиа (видео и изображений)
- Вывод пользовательских данных и др.

### Категории типовых уязвимостей

Типовые уязвимости сгруппированы как по механизмам, где они происходят, так и по характеру их эксплуатации, а также по
технологиям, в которых они обнаруживаются.

Типовые уязвимости по механизмам, где они происходят:

- Уязвимости механизмов аутентификации
- Уязвимости механизмов авторизации
- Уязвимости загрузки файлов
- Уязвимости раскрытия информации
- Уязвимости в системах криптографии и др.


Типовые уязвимости по характеру их эксплуатации:

- Уязвимости состояния гонки (race condition)
- Уязвимости некорректной нейтрализации управляющих конструкций при генерации веб-страниц (атаки межсайтового скриптинга)
- Уязвимости подделки запроса со стороны сервера (SSRF)
- Уязвимости подделки запроса со стороны клиента (CSRF) и др.


Типовые уязвимости по технологиям, в которых они происходят:

- Уязвимости SQL инъекций
- Уязвимости внедрения внешних сущностей в XML-документы
- Уязвимости инъекций в ORM-запросах
- Уязвимости инъекций в LDAP-запросах
- Уязвимости инъекции команд или аргументов в запросах к терминальной оболочке ОС


Категоризировать уязвимости можно по-разному. Важно то, что появляются все новые классы уязвимостей и атак вместе с
ростом технологий и их применением в различных ситуациях. Обладая знанием типовых уязвимостей веб-приложений, можно
эффективно искать и эксплуатировать возможности, предоставляемые приложением, для достижения целей проверки.

Мы рассмотрим несколько уязвимостей, возникающих на начальных этапах поиска возможностей компрометации веб-приложения и
на заключительных этапах, когда полная компрометация приложения становится возможной.

На начальных этапах мы сталкиваемся с механизмами аутентификации и контроля доступа.

На заключительных этапах самым большим достижением в демонстрации возможности компрометации является демонстрация
возможности выполнить произвольный код или команды ОС от имени веб-приложения.