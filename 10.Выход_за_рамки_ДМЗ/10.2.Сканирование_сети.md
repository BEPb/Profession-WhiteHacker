### Сканирование сети

Цели:

- Выявление уязвимых сервисов, которые приведут к компрометации новых узлов: SSH (22), FTP (21), SMB/RPC (135/445),
  MSSQL (1433), PostgreSQL (5432), Redis (6379), Web (80,443), Alternative Web (8080,8443), etc…
- Выявление доступных маршрутов трафика до узлов во внутренней сети компании: сканирование собственной локальной сети (
  172.16.0.0/12 или 192.168.0.0/16), сканирование локальной сети организации 10.0.0.0/8
- Обнаружение доступных сервисов сетевого оборудования: Cisco Smart Install (4786), Web (80,443), Cisco UCS Director
  Express for Big Data + VNC (8787/ 599), SSH (22), Mikrotik Neighbor Discovery Protocol (5678), Winbox (8291) и пр.

#### Поиск сервисов

Для поиска сервисов мы должны выполнить наиболее эффективные действия в определенном порядке: невозможно просканировать
большое сетевое пространство (например: 10.0.0.0/8) и обнаружить в нем все сетевые сервисы в
краткий промежуток времени.

Основные проблемы:

- Надежность сети
- Надежность узла сканирования (количество памяти, пропускная способность сети, возможная перегрузка)
- Высоконагруженные операции сканирования версий и подтверждения открытости портов

В связи с этим приходится выбирать: что сканировать в первую очередь, чтобы получить результат.

Зачастую вы будете стремиться к 2 целям:

- Как можно быстрее определить существующие узлы сети
- Как можно точнее определить сервисы на существующих узлах

Примеры соответствия этим 2 целям:

- Сканирование доступных узлов с использованием Ping-сканирования и ARP-скана, с отключением TCP сканирования: nmap-sn
  -n …
- Сканирование доступных узлов с использованием только TCP-сканирования: nmap -n -Pn -PS 22,23,445,135,80,8080 …
    - Подкручивание скорости сканирования при помощи шаблона скорости: nmap -T5 или самостоятельном указывании значения
      скорости: nmap --min-rate=400 --min-parallelism=512 …

          nmap -n -sn -T5 192.168.0.0/16

или

    map -n -Pn -PS 22,23,445,135,80,8080 192.168.0.0/16

Впоследствии проводится сканирование по списку выявленных узлов:

    nmap -n -Pn -T5 --top-ports=1000 -sV -iL scope.txt

Подробнее про подкручивание скорости сканирования: тут

### Обнаружение лазеек

Для обнаружения лазеек достаточно просканировать диапазон локальной сети на доступность узлов или отдельных портов и
протоколов при помощи nmap или masscan.
Обычно локальные сети компаний используют адресацию: 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16
Мы можем проверить доступность отдельных портов TCP/UDP или целых узлов сети:

        nmap -Pn -n -sU -p53 -T5 10.0.0.0/8 (Сканирование может занимать вплоть до суток)
        nmap -Pn -n -sS -p22 -T5 10.0.0.0/8
        nmap -sn -n -T5 --disable-arp-ping 10.0.0.0/8