### Анализ трафика

Анализ трафика может помочь нам лучше узнать сеть: выявить протоколы и сетевые соединения, которые относятся и на
принадлежащий нам узел сети ДМЗ.

Без понимания устройства сети данные, полученные на этом этапе, не дадут вам никакой информации. Для уверенного разбора
полученного трафика сети нужно хорошо разбираться в таких понятиях и техниках, как:

- TCP/IP-стек
- Атаки на широковещательные протоколы anycast/multicast
- Атаки “Man in The Middle”.

Что изучать?

- Широковещательные и мультикаст-пакеты протоколов: mDNS, DHCP, LLMNR, NBT-NS, NDP for IPv6, RTP
- Протоколы, которые впоследствии могут быть использованы для атак: DTP,STP,CDP, и пр.
- Сетевые соединения скомпрометированного узла с узлами остальной сети

Особенности:

- По MAC-адресам в сети возможно обнаружить виртуальные машины
- По используемым протоколам можно определять используемое в сети ПО и сетевое оборудование

Для анализа трафика чаще всего используются несколько инструментов захвата и мониторинга трафика:

- **Wireshark** — это свободно распространяемый сетевой анализатор, который используется для захвата и анализа сетевого
  трафика в режиме реального времени. Он позволяет просматривать данные, передаваемые по различным протоколам, и
  анализировать их в различных форматах.
- **tcpdump** — это утилита командной строки для захвата сетевого трафика в режиме реального времени. Она используется
  для
  мониторинга и анализа трафика на определенном сетевом интерфейсе, с возможностью фильтрации трафика по различным
  критериям, таким, как IP-адрес и порт назначения или источника.

tcpdump — утилита UNIX, позволяющая перехватывать и анализировать сетевой трафик, проходящий через компьютер, на
котором запущена данная программа. Для выполнения программы требуется наличие прав суперпользователя и прямой доступ к
устройству

    sudo tcpdump -i eth0 -nn -s0 -w test.pcap, где:


    -i : выбирает интерфейс, на котором будет производиться захват; чаще всего это карта ethernet или беспроводной адаптер,
    но может быть и vlan или что-то более необычное (не всегда требуется, если имеется только один сетевой адаптер)
    -nn : одинарное (n) не будет разрешать имена хостов, двойное (nn) не будет разрешать имена хостов или портов; это удобно
    не только для просмотра номеров IP/портов, но и при захвате большого количества данных, так как разрешение имен
    замедляет захват
    -s0 : snap length, размер пакета для захвата, установит неограниченный размер — используйте это, если вы хотите
    захватить весь трафик (извлечь двоичные файлы из сетевого трафика)
    -w : имя файла для записи захваченного трафика
    Команда для переноса трафика из tcpdump с удаленного узла, в интерфейс wireshark на локальном узле:
    ssh root@10.0.5.11 tcpdump -i any -s0 -nn -w - | wireshark -k -i -