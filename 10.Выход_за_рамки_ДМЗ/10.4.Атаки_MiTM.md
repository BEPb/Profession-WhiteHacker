### Атаки MiTM

Самыми популярными атаками в сети являются атаки:

- **Спуфинг:** в контексте сетевой безопасности spoofing attack (англ. spoofing — подмена) – это атаки, использующие
  механизм
  подмены источника, получателя или арбитра, а также любые ситуации, когда злоумышленник может подменять сущности,
  условия, значения и пр.
- **Сниффинг :** в той же сетевой безопасности sniffing (англ. to sniff — нюхать) – это атаки прослушивания трафика,
  проходящего через сетевую карту злоумышленника. Сниффинг может использоваться легально, чтобы изучить, какой трафик
  получает ваше устройство из сети, или может использоваться нелегитимно, когда злоумышленник нарушает работу сети и
  заставляет трафик прочих узлов сети проходить через его сетевую карту.

На базе этих 2 атак может быть выполнена наиболее известная сетевая атака: Man in The Middle (MiTM). Атаки MiTM бывают
очень разными, т.е. использующими разные протоколы, разное поведение протоколов, приводящее к различным последствиям.

Мы познакомимся с такими атаками, как:

- ARP Spoofing
- MiTM 6

О каких еще атаках вам стоит знать:

    ARP spoofing
    STP (RSTP, PVSTP, MSTP) spoofing
    NDP spoofing
    VLAN hopping
    SLAAC Attack
    Hijacking HSRP (VRRP, CARP)
    Dynamic routing protocol spoofing (BGP)
    RIPv2 Routing Table Poisoning
    OSPF Routing Table Poisoning
    EIGRP Routing Table Poisoning
    ICMP Redirect
    NetBIOS (LLMNR) spoofing
    DHCP spoofing

### ARP Spoofing

Протокол разрешения адресов (ARP) предназначен для преобразования IP-адресов в MAC-адреса. Все сетевые устройства,
которым необходимо взаимодействовать в сети, используют широковещательные ARP-запросы, чтобы узнать MAC-адреса других
машин.

Типичный пример атаки ARP spoofing

Перед проведением ARP-спуффинга в ARP-таблицах узлов Джона и Линды имеются записи с IP- и MAC-адресами друг друга.
Информация передается между этими узлами.

В процессе ARP-спуфинга компьютер атакующего, осуществляющий атаку, посылает ARP-ответы (без получения запросов =
gratuitous arp) -->

Узлу Джона: с IP-адресом узла Линды и MAC-адресом узла атакующего
Узлу Линды: с IP-адресом узла Джона и MAC-адресом узла атакующего
Поскольку компьютеры поддерживают беспричинный ARP, они изменяют свои собственные ARP-таблицы и помещают туда
записи, в которых вместо реального MAC-адреса компьютеров Джона и Линды стоит MAC-адрес компьютера атакующего.

**Беспричинный ARP (англ. Gratuitous ARP)**

**Gratuitous ARP (RFC 5227)** может означать как необоснованный ARP-запрос, так и необоснованный ARP-ответ. Gratuitous в
данном случае означает запрос/ответ, который обычно не нужен согласно спецификации ARP (RFC 826), но может быть
использован в некоторых случаях.

**Беспричинный ARP запрос** — это пакет запроса Address Resolution Protocol, в котором IP источника и назначения
установлены
на IP компьютера, издающего пакет, а MAC назначения — широковещательный адрес ff:ff:ff:ff:ff:ff:ff:ff. Как правило,
никакого ответного пакета не возникает.

Иначе говоря, беспричинный ARP-ответ — это ответ, на который не был сделан запрос.

Также существует вероятность успешной атаки другим способом. Когда вы будете наблюдать за arp-активностью в сегменте
сети и вдруг заметите arp-запрос жертвы, вы можете попробовать отправить arp-ответ жертве быстрее, чем адресат этого
запроса. Некоторые устройства могут принять этот трюк.

#### Инструменты для проведения атаки ARP Spoofing

**bettercap** - это мощный, легко расширяемый и переносимый фреймворк, написанный на языке Go. Он призван предложить
исследователям безопасности, "красным командам" и реверс-инженерам простое в использовании, универсальное решение со
всеми функциями, которые могут им понадобиться для проведения разведки и атак на сети WiFi, устройства Bluetooth Low
Energy, беспроводные устройства HID и сети Ethernet.

Пример команды:
bettercap -T 10.10.10.10 -X

Старая версия инструмента проще, но есть и новая, написанная на Go.

### MiTM 6

Под термином MiTM 6 подразумевают всевозможные атаки на протокол IPv6.

**IPv6** — новая версия интернет-протокола, призванная решить проблемы, с которыми столкнулась предыдущая версия при
её использовании в Интернете, за счёт целого ряда принципиальных изменений. Протокол был разработан IETF. Длина адреса
IPv6 составляет 128 бит, в отличие от адреса IPv4, длина которого равна 32 битам.

Самой популярной атакой на IPv6 является атака: Rogue DHCP (DHCPv6).

Принцип работы:

- Клиент Ipv6 посылает сообщение Solicit на адрес All_DHCP_Relay_Agents_and_Servers для поиска доступных серверов DHCP
- Любой сервер, который может удовлетворить требования клиента, отвечает сообщением Advertise
- Клиент выбирает один из серверов и посылает серверу сообщение Request с запросом на подтверждение назначения адресов и
другой информации о конфигурации
- Сервер отвечает сообщением Reply, содержащим подтвержденные адреса и конфигурацию.


Эта схема похожа на DHCPv4, поэтому основной целью злоумышленника является использование поддельного сервера DHCPv6 для
перенаправления трафика жертвы на себя. Злоумышленник может перехватить сообщение клиента DHCP solicit и ответить на
него, притворившись, что он является сервером DHCPv6, и назначить учетные данные (например, адрес DNS), которые будут
использоваться жертвой.

#### Почему это работает?

- IPv6 включен на всех Windows узлах по умолчанию
- Во многих сетях IPv6 не настроен
- IPv6 имеет приоритет над IPv4, соответственно, разрешение DNS имени будет происходить через DNS сервер в DHCP(6)
конфигурации

#### Инструменты атак

Наиболее важные инструменты атак для MiTM, сниффинга и спуфинга:

    ettercap
    bettercap
    mitm6
    yersinia
    scapy