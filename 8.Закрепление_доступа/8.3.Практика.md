### Практика «Закрепление доступа»
#### Подготовка
Требования к лабораторному стенду:

На вашей операционной системе должно быть установлено программное обеспечение docker и docker-compose.

Поддерживаемые ОС: Linux,Windows, MacOS (x64/arm).

На машине, с которой вы будете проводить атаки, должен быть настроен SSH клиент (В Linux может быть установлен по
умолчанию). И должен существовать SSH ключ, для того чтобы впоследствии подключиться к инструменту закрепления доступа в
системе.

На машине, с которой вы будете проводить атаки, должен быть установлен python3, чтобы впоследствии поднять HTTP сервер
для передачи файлов на скомпрометированную машину.

Для подготовки стенда:

Необходимо скачать архив по ссылке: persistence-lab.zip (Зеркало: persistence-lab.zip Яндекс.Диск)

Распаковать данный архив и перейти в появившуюся директорию persistance-lab-prod в терминальной оболочке вашей ОС.
Выполнить команду:

      docker-compose up -d

По адресу http://localhost:1337 появится приложение лабораторного стенда. А также появится порт 2022. К нему вы сможете
подключиться используя протокол ssh и команду:

      ssh -i ~/.ssh/id_rsa -p 2022 pupy@127.0.0.1

Для того чтобы подключение прошло успешно отправьте свой публичный SSH ключ в директорию для авторизованных ключей
приложения следующей командой:

      cp ~/.ssh/id_rsa.pub /tmp/projects/keys/authorized_keys

Если у вас нет существующих SSH ключей, сгенерируйте их. Выполните команду ssh-keygen и нажмите enter несколько раз до
окончания работы скрипта.

Возможные проблемы:

1. Если вы не отключили прошлые лабораторные стенды, может появиться ошибка:

         Bind for 0.0.0.0:1337 failed: port is already allocated.

В таком случае, выполните команду docker ps найдите запущенный контейнер, который использует занятый ранее порт, и
остановите его командой:

      docker stop [имя контейнера или его идентификатор]

2. Если ранее на своем же узле вы поднимали SSH сервисы, то цифровая подпись вашего нового сервиса может не совпадать со
   старой. В таком случае SSH клиент не даст вам подключиться к своему же сервису и выведет ошибку:

         @ WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @

Это значит, что в файле ~/.ssh/known_hosts осталась прежняя цифровая подпись для узла 127.0.0.1.

Чтобы исключить эту ошибку нужно зайти в файл  ~/.ssh/known_hosts и удалить записи связанные с IP адресом 127.0.0.1 из
файла.

Выглядеть данные строки могут так:

      [127.0.0.1]:2022 ecdsa-sha2-nistp256 AAAA………….……1cV6VE=

3. Ваш SSH клиент может не находить SSH ключа, который вы сгенерировали и передали его публичную часть приложению. В
   таком случае выполните команду:

      ssh -i ~/.ssh/id_rsa -p 2022 pupy@127.0.0.1,

и вместо ~/.ssh/id_rsa укажите путь до сгенерированного вами закрытого ключа SSH.