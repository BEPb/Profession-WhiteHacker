### 7.2 Поиск email-адресов

#### Техника поиска email-адресов сотрудников организации

Первый принцип работы данной техники заключается в том, что если нам нужно найти электронный адрес только одного
сотрудника, то мы можем ее поискать в различных утечках баз данных. Или, зная маску корпоративной почты сотрудников
организации, мы можем подобрать адрес нужной нам электронной почты с помощью генератора email-адресов.

Второй принцип основан на Simple Mail Transfer Protocol (SMTP), который предназначен для пересылки писем из одной
системы в другую.

Этот протокол используют почтовые клиенты, такие как Outlook, и почтовые серверы, такие как Microsoft Exchange,
межсетевые экраны и т.д.

У SMTP есть две главные задачи:

- Проверка корректности настроек системы и предоставление разрешения на отправку email-сообщения для определенного
  устройства;
- Отправка исходящего сообщения на заданный адрес электронной почты и подтверждение успешной доставки. Если сообщение
  доставить не удается, отправитель получает соответствующее извещение.

Связь по этому протоколу по умолчанию осуществляется в виде открытого текста. Но в настоящее время вы, скорее всего,
увидите, как почтовые серверы переключаются с обычного текста на защищенный канал с помощью SSL/TLS.

**Порты по умолчанию — 25, 465 (больше не используется) и 587.**

Где 25 предназначен для использования при отправке от вашего почтового клиента на почтовый сервер, а более высокие порты
для ретрансляции между SMTP-сервером. SMTP-сервер может действовать как клиент и как сервер, так как он должен
отправлять и получать электронные письма одновременно. Рассмотрим брандмауэр, который обрабатывает все ваши электронные
письма, как исходящие, так и входящие — в обоих случаях задействован SMTP.

Некоторые термины, используемые вместе с SMTP:

**Почтовый пользовательский агент (MUA)**: визуальная часть программы, подключающейся к SMTP-серверу для отправки
электронной почты. Скорее всего, это ваш Outlook, Thunderbird или что угодно.

**Агент пересылки почты (MTA)**: транспортная часть программы. Он получает и передает электронные письма. Это может быть
сервер Exchange, шлюз с выходом в Интернет и так далее.

В Интернете Вы сможете больше узнать об SMTP, и непременно встретите такие термины как агент отправки почты (MSA), агент
доставки почты (MDA), и некоторые другие.

Это особые функции программы, участвующие в рабочем процессе электронной почты, которые позволяют описать процесс более
точно и детально. MSA является важной составляющей для получения электронной почты от MUA и MDA, и для передачи письма к
конечному принимающему MUA. Таким образом, рабочий процесс передачи электронного письма от одного пользователя к другому
может выглядеть так:

    MUA → MSA → MTA → Интернет → MTA → MDA → MUA

Также следует помнить, что у сотрудников организации есть личные электронные адреса. Корпоративная почта – это почтовый
ящик, который размещен на домене, принадлежащем организации. В их адресах будет присутствовать доменное имя компании, а
в личных почтовых ящиках мы увидим yandex, mail, bk, gmail и тд.

### Инструменты

Исходя из того, какого принципа поиска вы будете придерживаться, можно использовать следующие инструменты:

Email Permutator+ – автоматически составляет список возможных адресов. Просто заполните поля формы и дождитесь, пока он
составит список.
**Для верификации можно воспользоваться следующими сервисами:**

    https://tools.emailhippo.com/
    https://www.verifyemailaddress.org/
    https://verify-email.org/
    https://verifalia.com/validate-email
    https://quickemailverification.com/
    https://www.accuwebhosting.com/blog/top-10-bulk-email-list-verification-validation-services-compared/

**Whois** — протокол, основная цель которого заключается в получении регистрационных данных о владельцах доменных имён,
IP-адресах и автономных систем (ASN).

    https://whois.ru/
    https://dnschecker.org/ip-whois-lookup.php
    https://bgp.he.net/

**OSINT:**

**Infoga** – инструмент, собирающий информацию об учетных записях электронной почты (ip,имя хоста, страна,…) из
различных
открытых источников (поисковые системы, серверы ключей pgp и shodan) и проверяющий, не произошла ли утечка электронной
почты с помощью haveibeenpwned.com API.

**Maltego** – мощная программа для сбора информации из различных баз данных, а также их представления в удобном для
понимания формате (строит логические связи между данными).

**LeakCheck** – поиск данных среди >7.8 млрд записей включающие более 3000 баз данных. Поиск по имени, почте, ключевым
словам, паролям или корпоративным доменным именам.

**h8mail** – представляет собой инструмент OSINT для поиска электронных почт и нарушений, использующие различные службы
взлома и разведки, или локальные нарушения (например, Collection 1 Троя Ханта, торрент “Breach Compilation”).

**Hunter** – позволяет за считанные секунды найти адреса электронных почт, информацию о том, на каких ресурсах они были
опубликованы, и связаться с ними.

Зарубежный ресурс **Datanyze.com** также помогает наводить справки, но подходит скорее для иностранных пользователей. В
нем
достаточно указать название компании, в которой работает искомый человек. После этого вы получите список электронных
ящиков, российские компании он почти не знает.

**Google Dorks**

    pagodo – Passive Google Dork
    emailrep — сайт найдет на каких сервисах был зарегистрирован аккаунт, использующий определенную почту.
    dehashed.com — проверка почты в слитых базах.
    DuckDuckGo «@domainname.com» → поиск

Ещё один непопулярный, но рабочий способ найти email — воспользоваться DuckDuckGo. Запустите поиск по точному
соответствию имени домена с символом @ (@domainname.com), и он вам выдаст адреса почты, которые к нему относятся (если
они есть в открытом доступе). Можно добавить к запросу имя лида, это сократит время поиска нужного адреса.

**Twitter как инструмент для поиска лидов**
В США люди нередко скидывают свой email-адрес в комментариях к твитам* . Единственная защита от парсинга, которую
используют, — заменяют символы «.» и «@» словами «dot» и «at». Для того, чтобы проверить этот способ, откройте
расширенный поиск в Twitter*, поищите слова «dot» и «at» в твитах того, кто вам нужен. Дополнительно можно включить в
поиск слова «email», «contact» или «reach».

Утилиты:

hydra – это распараллеленный брутфорс паролей к различным сервисам (FTP, POP3, IMAP, Telnet, HTTP Auth, NNTP, VNC, ICQ,
PCNFS, CISCO и др.) для UNIX платформ. С помощью этой утилиты вы можете атаковать несколько сервисов одновременно.
theHarvester – это простой в использовании, но мощный инструмент, предназначенный для использования на этапе разведки.
Он выполняет сбор информации из открытых источников (OSINT), чтобы помочь определить уровень внешних угроз домена.
Инструмент собирает имена, адреса электронной почты, IP-адреса, поддомены и URL-адреса с помощью несколько общедоступных
ресурсов.

*в настоящее время социальная сеть X

### Алгоритм исполнения техники

Последовательность шагов

Для того, чтобы найти корпоративную почту конкретного сотрудника, нам нужно узнать маску электронных адресов данной
компании.

После того, как мы находим маску, то мы можем узнать корпоративные почты других сотрудников, например с помощью перебора
на SMTP-сервере.

Пример 1

- На сайте компании найти почту для обратной связи, для того, чтобы определить маску электронного адреса:

- Затем, в нашем случае, смотрим на перечень преподавателей, которые представлены на сайте. Здесь нам нужны фамилия и
  имя:

- Открываем сайт генерации почт и вводим имя, фамилию и домен компании:

- Сайт сгенерировал нам следующее:
  Поскольку мы не знаем начальную маску почты, то начинаем проверять почты на ее существование.

- Мы нашли начальную маску почты и теперь можно узнать почты других сотрудников.

Для того, чтобы найти остальные почты воспользуемся расширением Name2Email by Reply, и, зная доменное имя, через “@”
можем найти все остальные почты сотрудников компании.

https://name2email.com/Content/misc/overview.mp4

Также можно использовать Hydra (Windows, Linux), которая позволяет перебрать email-адреса на SMTP-сервере.

Далее устанавливаем или генерируем userlist, который будет перебирать email на сервере.

Для того, чтобы проверить на каком порту висит SMTP, можно использовать nmap.

```commandline
hydra -L userlist.txt -s 465 smtp.gmail.com smtp
-L - файл, где содержатся сгенерированные логины
-s - порт
smtp.google.com - SMTP-сервер
smtp - протокол
```

#### Когда и как применять технику?

Например, если пользователь найдет существующую почту, то он может посмотреть, не была ли она обнаружена в слитых базах
данных. Если была обнаружена, то можно получить к ней доступ: таким образом, есть возможность получить доступ к
внутренней информации компании и не только.

Ввиду последних событий большинство компаний по доставке еды были подвержены атаке: были слиты базы данных
пользователей. Если искать среди этих баз, то можно узнать персональные данные сотрудника.

Эффективность техники измеряется в таких параметрах, как:

- Скорость
- Качество результатов

#### Как повысить эффективность техники

Повысить скорость:
- Можно, автоматизировав процесс поиска корпоративных почт (например, hunter). Также скорость повышается за счет
использования перебора почт на SMTP-сервере.
- Повысить качество результатов:
Повышается за счет использования больших исходных данных, а также использования нескольких сервисов для поиска, проверки
валидности с искомые данные.
- Комбинирование:
Различных методов поиска информации (например, не только с помощью слитых баз данных, а также с помощью открытых
источников). Также следует комбинировать поиск информации с помощью скриптов и Telegram-ботов.